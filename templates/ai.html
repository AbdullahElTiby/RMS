{% extends "base.html" %}

{% block title %}AI Assistant - RMS{% endblock %}

{% block extra_head %}
    <style>
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .header h1 { color: #333; margin: 0; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; font-size: 14px; margin: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }
        .ai-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .ai-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; }
        .ai-card h3 { margin-top: 0; color: #495057; }
        .ai-card p { color: #6c757d; margin-bottom: 15px; }
        .result-box { background: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; padding: 15px; margin-top: 15px; white-space: pre-wrap; font-family: monospace; max-height: 300px; overflow-y: auto; }
        .loading { text-align: center; padding: 20px; color: #6c757d; }
        .error { color: #dc3545; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; padding: 10px; margin-top: 10px; }
        .success { color: #155724; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; padding: 10px; margin-top: 10px; }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="header">
            <h1 data-i18n="ai_assistant_title">ü§ñ AI Restaurant Assistant</h1>
            <div style="display:flex; align-items:center; gap:10px;">
                <label for="langSelect" data-i18n="language">Language</label>
                <select id="langSelect">
                    <option value="en">English</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                    <option value="tr">T√ºrk√ße</option>
                </select>
                <a href="/dashboard" class="btn btn-secondary" data-i18n="back_to_dashboard">Back to Dashboard</a>
            </div>
        </div>

        <div class="ai-grid">
            <!-- Inventory Insights -->
            <div class="ai-card">
                <h3 data-i18n="inventory_insights_title">üìä Inventory Insights</h3>
                <p data-i18n="inventory_insights_desc">Analyze your inventory levels, usage patterns, and get smart recommendations for stock management.</p>
                <button class="btn btn-primary" onclick="getInventoryInsights()" data-i18n="get_insights">Get Insights</button>
                <div id="insights-result" class="result-box" style="display: none;"></div>
            </div>

            <!-- Menu Suggestions -->
            <div class="ai-card">
                <h3 data-i18n="menu_suggestions_title">üçΩÔ∏è Menu Suggestions</h3>
                <p data-i18n="menu_suggestions_desc">Get AI-powered menu recommendations based on your current inventory and seasonal trends.</p>
                <button class="btn btn-success" onclick="getMenuSuggestions()" data-i18n="get_suggestions">Get Suggestions</button>
                <div id="menu-result" class="result-box" style="display: none;"></div>
            </div>

            <!-- Demand Prediction -->
            <div class="ai-card">
                <h3 data-i18n="demand_prediction_title">üîÆ Demand Prediction</h3>
                <p data-i18n="demand_prediction_desc">Predict ingredient demand for the next few days based on historical usage patterns.</p>
                <label for="days-ahead" data-i18n="days_ahead">Days ahead:</label>
                <select id="days-ahead" style="margin-left: 10px; padding: 5px;">
                    <option value="3" data-i18n="3_days">3 days</option>
                    <option value="7" selected data-i18n="7_days">7 days</option>
                    <option value="14" data-i18n="14_days">14 days</option>
                    <option value="30" data-i18n="30_days">30 days</option>
                </select>
                <br><br>
                <button class="btn btn-warning" onclick="getDemandPrediction()" data-i18n="predict_demand">Predict Demand</button>
                <div id="demand-result" class="result-box" style="display: none;"></div>
            </div>

            <!-- Inventory Optimization -->
            <div class="ai-card">
                <h3 data-i18n="inventory_optimization_title">‚ö° Inventory Optimization</h3>
                <p data-i18n="inventory_optimization_desc">Get recommendations for optimizing your inventory turnover, reducing waste, and improving efficiency.</p>
                <button class="btn btn-info" onclick="getInventoryOptimization()" data-i18n="optimize_inventory">Optimize Inventory</button>
                <div id="optimization-result" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- AI Chat Section -->
        <div class="ai-card" style="grid-column: 1 / -1;">
            <h3 data-i18n="ai_chat_title">üí¨ AI Restaurant Chat</h3>
            <p data-i18n="ai_chat_desc">Ask me anything about your restaurant operations, inventory, menu planning, or business optimization!</p>

            <div id="chat-messages" style="max-height: 400px; overflow-y: auto; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin-bottom: 15px;">
                <div class="message ai-message">
                    <strong id="aiAssistantLabel">AI Assistant:</strong> <span id="aiWelcomeText">Hello! I'm your restaurant AI assistant. I can help you with inventory management, menu planning, demand forecasting, and business optimization. What would you like to know?</span>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <input type="text" id="chat-input" placeholder="Ask me anything about your restaurant..." style="flex: 1; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;" data-i18n-placeholder="chat_placeholder">
                <button class="btn btn-primary" onclick="sendChatMessage()" data-i18n="send">Send</button>
            </div>

            <div style="margin-top: 10px;">
                <small style="color: #6c757d;" data-i18n="chat_examples">Try asking: "What's my best-selling item this month?" or "How can I reduce food waste?"</small>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // i18n translations for AI page
    const translations = {
        en: { ai_assistant_title: 'ü§ñ AI Restaurant Assistant', inventory_insights_title: 'üìä Inventory Insights', inventory_insights_desc: 'Analyze your inventory levels, usage patterns, and get smart recommendations for stock management.', get_insights: 'Get Insights', menu_suggestions_title: 'üçΩÔ∏è Menu Suggestions', menu_suggestions_desc: 'Get AI-powered menu recommendations based on your current inventory and seasonal trends.', get_suggestions: 'Get Suggestions', demand_prediction_title: 'üîÆ Demand Prediction', demand_prediction_desc: 'Predict ingredient demand for the next few days based on historical usage patterns.', days_ahead: 'Days ahead:', '3_days': '3 days', '7_days': '7 days', '14_days': '14 days', '30_days': '30 days', predict_demand: 'Predict Demand', inventory_optimization_title: '‚ö° Inventory Optimization', inventory_optimization_desc: 'Get recommendations for optimizing your inventory turnover, reducing waste, and improving efficiency.', optimize_inventory: 'Optimize Inventory', ai_chat_title: 'üí¨ AI Restaurant Chat', ai_chat_desc: 'Ask me anything about your restaurant operations, inventory, menu planning, or business optimization!', chat_placeholder: 'Ask me anything about your restaurant...', send: 'Send', chat_examples: 'Try asking: "What\'s my best-selling item this month?" or "How can I reduce food waste?"', language: 'Language', back_to_dashboard: 'Back to Dashboard', analyzing: 'AI is analyzing...', ai: 'AI:', you: 'You:', welcome: 'Hello! I\'m your restaurant AI assistant. I can help you with inventory management, menu planning, demand forecasting, and business optimization. What would you like to know?' },
        ar: { ai_assistant_title: 'ü§ñ ŸÖÿ≥ÿßÿπÿØ ÿßŸÑŸÖÿ∑ÿπŸÖ ÿßŸÑÿ∞ŸÉŸä', inventory_insights_title: 'üìä ÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ', inventory_insights_desc: 'ÿ≠ŸÑŸÑ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ŸÖÿÆÿ≤ŸàŸÜŸÉ Ÿàÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸàÿµŸäÿßÿ™ ÿ∞ŸÉŸäÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ.', get_insights: 'ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™', menu_suggestions_title: 'üçΩÔ∏è ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©', menu_suggestions_desc: 'ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸàÿµŸäÿßÿ™ ŸÇÿßÿ¶ŸÖÿ© ŸÖÿØÿπŸàŸÖÿ© ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿÆÿ≤ŸàŸÜŸÉ ÿßŸÑÿ≠ÿßŸÑŸä ŸàÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™ ÿßŸÑŸÖŸàÿ≥ŸÖŸäÿ©.', get_suggestions: 'ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™', demand_prediction_title: 'üîÆ ÿ™ŸàŸÇÿπ ÿßŸÑÿ∑ŸÑÿ®', demand_prediction_desc: 'ÿ™ŸàŸÇÿπ ÿßŸÑÿ∑ŸÑÿ® ÿπŸÑŸâ ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ŸÑŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©.', days_ahead: 'ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖŸÇÿ®ŸÑÿ©:', '3_days': '3 ÿ£ŸäÿßŸÖ', '7_days': '7 ÿ£ŸäÿßŸÖ', '14_days': '14 ŸäŸàŸÖ', '30_days': '30 ŸäŸàŸÖ', predict_demand: 'ÿ™ŸàŸÇÿπ ÿßŸÑÿ∑ŸÑÿ®', inventory_optimization_title: '‚ö° ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ', inventory_optimization_desc: 'ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸàÿµŸäÿßÿ™ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿØŸàÿ±ÿßŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ Ÿàÿ™ŸÇŸÑŸäŸÑ ÿßŸÑŸáÿØÿ± Ÿàÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÉŸÅÿßÿ°ÿ©.', optimize_inventory: 'ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ', ai_chat_title: 'üí¨ ÿØÿ±ÿØÿ¥ÿ© ÿßŸÑŸÖÿ∑ÿπŸÖ ÿßŸÑÿ∞ŸÉŸäÿ©', ai_chat_desc: 'ÿßÿ≥ÿ£ŸÑŸÜŸä ÿ£Ÿä ÿ¥Ÿäÿ° ÿπŸÜ ÿπŸÖŸÑŸäÿßÿ™ ŸÖÿ∑ÿπŸÖŸÉ ŸàŸÖÿÆÿ≤ŸàŸÜŸÉ Ÿàÿ™ÿÆÿ∑Ÿäÿ∑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£Ÿà ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿßŸÑ!', chat_placeholder: 'ÿßÿ≥ÿ£ŸÑŸÜŸä ÿ£Ÿä ÿ¥Ÿäÿ° ÿπŸÜ ŸÖÿ∑ÿπŸÖŸÉ...', send: 'ÿ•ÿ±ÿ≥ÿßŸÑ', chat_examples: 'ÿ¨ÿ±ÿ® ÿßŸÑÿ≥ÿ§ÿßŸÑ: "ŸÖÿß ŸáŸà ÿ£ŸÉÿ´ÿ± ÿ£ÿµŸÜÿßŸÅŸä ŸÖÿ®ŸäÿπŸãÿß Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±ÿü" ÿ£Ÿà "ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ÿ™ŸÇŸÑŸäŸÑ ŸáÿØÿ± ÿßŸÑÿ∑ÿπÿßŸÖÿü"', language: 'ÿßŸÑŸÑÿ∫ÿ©', back_to_dashboard: 'ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ', analyzing: 'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä Ÿäÿ≠ŸÑŸÑ...', ai: 'ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä:', you: 'ÿ£ŸÜÿ™:', welcome: 'ŸÖÿ±ÿ≠ÿ®ÿß! ÿ£ŸÜÿß ŸÖÿ≥ÿßÿπÿØŸÉ ÿßŸÑÿ∞ŸÉŸä ŸÑŸÑŸÖÿ∑ÿπŸÖ. ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ Ÿàÿ™ÿÆÿ∑Ÿäÿ∑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© Ÿàÿ™ŸàŸÇÿπ ÿßŸÑÿ∑ŸÑÿ® Ÿàÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿπŸÖÿßŸÑ. ŸÖÿßÿ∞ÿß ÿ™ÿ±ŸäÿØ ÿ£ŸÜ ÿ™ÿπÿ±ŸÅÿü' },
        tr: { ai_assistant_title: 'ü§ñ AI Restoran Asistanƒ±', inventory_insights_title: 'üìä Stok Analizleri', inventory_insights_desc: 'Stok seviyelerinizi, kullanƒ±m paternlerinizi analiz edin ve stok y√∂netimi i√ßin akƒ±llƒ± √∂neriler alƒ±n.', get_insights: 'Analizleri Al', menu_suggestions_title: 'üçΩÔ∏è Men√º √ñnerileri', menu_suggestions_desc: 'Mevcut stokunuz ve mevsimsel trendlere dayalƒ± AI destekli men√º √∂nerileri alƒ±n.', get_suggestions: '√ñnerileri Al', demand_prediction_title: 'üîÆ Talep Tahmini', demand_prediction_desc: 'Tarihsel kullanƒ±m paternlerine dayanarak gelecek g√ºnlerdeki malzeme talebini tahmin edin.', days_ahead: 'G√ºnler ilerisi:', '3_days': '3 g√ºn', '7_days': '7 g√ºn', '14_days': '14 g√ºn', '30_days': '30 g√ºn', predict_demand: 'Talebi Tahmin Et', inventory_optimization_title: '‚ö° Stok Optimizasyonu', inventory_optimization_desc: 'Stok devir hƒ±zƒ±nƒ±zƒ± optimize etmek, atƒ±klarƒ± azaltmak ve verimliliƒüi artƒ±rmak i√ßin √∂neriler alƒ±n.', optimize_inventory: 'Stoƒüu Optimize Et', ai_chat_title: 'üí¨ AI Restoran Sohbeti', ai_chat_desc: 'Restoran operasyonlarƒ±nƒ±z, stokunuz, men√º planlamanƒ±z veya i≈ü optimizasyonunuz hakkƒ±nda herhangi bir ≈üey sorun!', chat_placeholder: 'Restoranƒ±nƒ±z hakkƒ±nda herhangi bir ≈üey sorun...', send: 'G√∂nder', chat_examples: '≈ûunu sorun: "Bu ay en √ßok satan √ºr√ºn√ºm nedir?" veya "Gƒ±da israfƒ±nƒ± nasƒ±l azaltabilirim?"', language: 'Dil', back_to_dashboard: 'Panele D√∂n', analyzing: 'AI analiz ediyor...', ai: 'AI:', you: 'Sen:', welcome: 'Merhaba! Restoran AI asistanƒ±nƒ±zƒ±m. Stok y√∂netimi, men√º planlama, talep tahmini ve i≈ü optimizasyonunda size yardƒ±mcƒ± olabilirim. Ne √∂ƒürenmek istersiniz?' }
    };

    function applyTranslations(lang) {
        const dict = translations[lang] || translations.en;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (dict[key]) {
                if (el.tagName === 'INPUT' && el.hasAttribute('placeholder')) {
                    el.placeholder = dict[key];
                } else {
                    el.textContent = dict[key];
                }
            }
        });
        document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
        document.body.style.textAlign = (lang === 'ar') ? 'right' : 'left';
    }

    function initI18n() {
        const saved = localStorage.getItem('lang') || 'en';
        const select = document.getElementById('langSelect');
        if (select) {
            select.value = saved;
            select.addEventListener('change', () => {
                const lang = select.value;
                localStorage.setItem('lang', lang);
                applyTranslations(lang);
            });
        }
        applyTranslations(saved);
    }

    async function checkAuth() {
        if (!localStorage.getItem('user')) {
            window.location.href = '/login';
            return false;
        }
        return true;
    }

    async function makeAIRequest(endpoint, resultElementId) {
        if (!await checkAuth()) return;

        const resultDiv = document.getElementById(resultElementId);
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="loading">ü§ñ AI is analyzing your data...</div>';

        try {
            // Add language parameter to the endpoint
            const currentLang = localStorage.getItem('lang') || 'en';
            const url = new URL(endpoint, window.location.origin);
            url.searchParams.set('lang', currentLang);

            const response = await fetch(url.toString());
            const data = await response.json();

            if (response.ok) {
                resultDiv.innerHTML = `<div class="success">${data.insights || data.suggestions || data.prediction || data.optimization}</div>`;
            } else {
                resultDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            }
        } catch (error) {
            resultDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
    }

    async function getInventoryInsights() {
        await makeAIRequest('/api/ai/inventory-insights', 'insights-result');
    }

    async function getMenuSuggestions() {
        await makeAIRequest('/api/ai/menu-suggestions', 'menu-result');
    }

    async function getDemandPrediction() {
        const days = document.getElementById('days-ahead').value;
        await makeAIRequest(`/api/ai/demand-prediction?days=${days}`, 'demand-result');
    }

    async function getInventoryOptimization() {
        await makeAIRequest('/api/ai/optimize-inventory', 'optimization-result');
    }

    async function sendChatMessage() {
        if (!await checkAuth()) return;

        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;

        // Add user message
        addMessage('user', message);
        input.value = '';

        // Show typing indicator
        const currentLang = localStorage.getItem('lang') || 'en';
        const trans = translations[currentLang] || translations.en;
        const typingDiv = addMessage('ai', `ü§ñ ${trans.analyzing || 'AI is analyzing...'}`);

        try {
            // Use the actual AI service with language context
            const response = await fetch('/api/ai/context-chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    context: {
                        title: 'AI Restaurant Assistant',
                        url: '/ai',
                        content: 'AI Restaurant Assistant page with features for inventory insights, menu suggestions, demand prediction, and inventory optimization.',
                        timestamp: new Date().toISOString(),
                        language: currentLang
                    }
                })
            });

            const data = await response.json();

            if (response.ok) {
                typingDiv.innerHTML = `<strong>${trans.ai || 'AI:'}</strong> ${data.response}`;
            } else {
                typingDiv.innerHTML = `<strong>${trans.ai || 'AI:'}</strong> ‚ùå ${data.error || 'Error occurred'}`;
            }
        } catch (error) {
            typingDiv.innerHTML = `<strong>${trans.ai || 'AI:'}</strong> ‚ùå ${error.message}`;
        }
    }

    function addMessage(type, content) {
        const messagesDiv = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        messageDiv.style.marginBottom = '10px';
        messageDiv.style.padding = '10px';
        messageDiv.style.borderRadius = '4px';
        messageDiv.style.background = type === 'user' ? '#007bff' : '#e9ecef';
        messageDiv.style.color = type === 'user' ? 'white' : 'black';

        const currentLang = localStorage.getItem('lang') || 'en';
        const trans = translations[currentLang] || translations.en;

        if (type === 'user') {
            messageDiv.innerHTML = `<strong>${trans.you || 'You:'}</strong> ${content}`;
        } else {
            messageDiv.innerHTML = content;
        }

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        return messageDiv;
    }

    async function simulateAIResponse(message) {
        // Simulate AI processing time
        await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));

        // Simple response logic - in a real app, this would call an AI API
        const lowerMessage = message.toLowerCase();

        if (lowerMessage.includes('inventory') || lowerMessage.includes('stock')) {
            return "I can help you with inventory management! Try using the 'Inventory Insights' feature above to get detailed analysis of your stock levels and recommendations.";
        } else if (lowerMessage.includes('menu') || lowerMessage.includes('food')) {
            return "For menu-related questions, I recommend checking the 'Menu Suggestions' feature. It can help you optimize your menu based on current inventory and customer preferences.";
        } else if (lowerMessage.includes('sales') || lowerMessage.includes('revenue')) {
            return "I can analyze your sales data! Check the Reports section in your dashboard for detailed sales analytics and trends.";
        } else if (lowerMessage.includes('waste') || lowerMessage.includes('reduce')) {
            return "To reduce food waste, focus on accurate demand forecasting and portion control. The 'Inventory Optimization' feature can provide specific recommendations for your restaurant.";
        } else {
            return "I'm here to help with restaurant management! I can assist with inventory analysis, menu planning, demand forecasting, and business optimization. What specific area would you like help with?";
        }
    }

    // Add enter key support for chat
    document.getElementById('chat-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendChatMessage();
        }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', async function() {
        if (!await checkAuth()) return;

        // Initialize i18n
        initI18n();

        // Add welcome message
        setTimeout(() => {
            const currentLang = localStorage.getItem('lang') || 'en';
            const trans = translations[currentLang] || translations.en;
            addMessage('ai', `<strong>${trans.ai || 'AI:'}</strong> ${trans.welcome || 'Hello! I\'m your restaurant AI assistant. I can help you with inventory management, menu planning, demand forecasting, and business optimization. What would you like to know?'}`);
        }, 1000);
    });
</script>
{% endblock %}
